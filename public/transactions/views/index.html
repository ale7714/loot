<table id="transactions" class="table table-striped table-bordered table-hover table-condensed" og-table-navigable="tableActions">
	<thead id="transactions-header" ng-switch="context.account_type">
		<!-- Investment account column headings -->
		<tr ng-switch-when="investment">
			<th class="transaction-date">Date</th>
			<th class="details">Details</th>
			<th class="amount">Quantity</th>
			<th class="amount">Price</th>
			<th class="amount">Total</th>
		</tr>
		<!-- Non-investment account column headings -->
		<tr ng-switch-default>
			<th class="transaction-date">Date</th>
			<th class="details">Details</th>
			<th class="amount">Debit</th>
			<th class="amount">Credit</th>
			<th class="amount">Balance</th>
		</tr>
		<tr>
			<td colspan="5" ng-switch="reconciling">
				<!-- Pagination -->
				<button class="btn btn-primary" ng-click="getTransactions('prev')">Previous</button>
				<span>{{firstTransactionDate | date:"dd/MM/yyyy"}} - {{lastTransactionDate | date:"dd/MM/yyyy"}}</span>
				<!-- Account reconciliation progress -->
				<span ng-switch-when="true" class="pull-right">
					<div class="text-right">Target: {{reconcileTarget | currency}}</div>
					<div class="text-right">Cleared: {{clearedTotal | currency }}</div>
					<div class="text-right" ng-class="{'text-danger': unclearedTotal != 0, 'text-success': unclearedTotal == 0}">Uncleared: {{unclearedTotal | currency}}</div>
					<button class="btn btn-default" type="button" ng-click="cancel()">Cancel</button>
					<button class="btn btn-success" type="submit" ng-click="save()" ng-disabled="unclearedTotal != 0"><i class="glyphicon glyphicon-ok"></i> Finished</button>
				</span>
				<!-- Account reconciliation tools -->
				<span ng-if="reconcilable" ng-switch-default class="pull-right">
					<label>
						<input type="checkbox" ng-model="unreconciledOnly" ng-click="toggleUnreconciledOnly($event.target.checked)">
						Unreconciled Only
					</label>
					<button class="btn btn-default" ng-click="reconcile()"><i class="glyphicon glyphicon-pencil"></i> Reconcile</button>
				</span>
			</td>
		</tr>
		<!-- Loading indicator -->
		<tr og-table-loading="loading['prev']" colspan="5"></tr>
	</thead>
	<tbody ng-class="{'reconciling': reconciling}">
		<tr class="transaction" ng-repeat="transaction in transactions" ng-switch="context.account_type" ng-class="{'cleared': transaction.status == 'Cleared'}">
			<!-- Transaction date -->
			<td class="has-action">
				{{transaction.transaction_date | date:'dd/MM/yyyy'}}
				<i class="action glyphicon glyphicon-flag text-danger pull-right flag" ng-class="{'active': transaction.flag}" tooltip="{{transaction.flag || 'Flag transaction...'}}" ng-click="flag($index)"></i>
			</td>
			<!-- Details table -->
			<td class="details">
				<table class="table-condensed">
					<tr>
						<td colspan="2" class="has-action" ng-switch="contextType == 'payee' || contextType == 'security'">
							<!-- Transaction status -->
							<small ng-if="reconcilable" ng-switch="reconciling" class="transaction-status pull-right">
								<input ng-switch-when="true" type="checkbox" ng-model="transaction.status" ng-true-value="Cleared" ng-false-value="" ng-change="toggleCleared(transaction)">
								<span ng-switch-default transaction-status="{'account': context, 'transaction': transaction}"></span>
							</small>
							<!-- Primary Account -->
							<span ng-switch-when="true">
								{{transaction.primary_account.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.primary_account.name}}" ng-click="switchPrimaryAccount($event, transaction)"></i>
							</span>
							<!-- Payee -->
							<span ng-switch-default ng-if="transaction.payee.id">
								{{transaction.payee.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.payee.name}}" ng-click="switchPayee($event, transaction)"></i>
							</span>
							<!-- Security -->
							<span ng-switch-default ng-if="transaction.security.id">
								{{transaction.security.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.security.name}}" ng-click="switchSecurity($event, transaction)"></i>
							</span>
						</td>
					</tr>
					<tr>
						<td class="category has-action" ng-switch="!context.parent && contextType == 'category'">
							<!-- Primary Account -->
							<span ng-switch-when="true">
								{{transaction.primary_account.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.primary_account.name}}" ng-click="switchPrimaryAccount($event, transaction)"></i>
							</span>
							<!-- Category -->
							<span ng-switch-default>
								{{transaction.category.name}}
								<i ng-if="['Basic', 'Sub'].indexOf(transaction.transaction_type) != -1" class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.category.name}}" ng-click="switchCategory($event, transaction)"></i>
							</span>
						</td>
						<td class="category has-action" ng-switch="context.parent && contextType == 'category'">
							<!-- Primary Account -->
							<span ng-switch-when="true">
								{{transaction.primary_account.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.primary_account.name}}" ng-click="switchPrimaryAccount($event, transaction)"></i>
							</span>
							<!-- Subcategory -->
							<span ng-switch-default ng-if="['Basic', 'Sub'].indexOf(transaction.transaction_type) != -1">
								{{transaction.subcategory.name}}
								<i ng-if="transaction.subcategory" class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.subcategory.name}}" ng-click="switchSubcategory($event, transaction)"></i>
							</span>
							<!-- Transfer / Other Account -->
							<span ng-switch-default ng-if="['Transfer', 'Subtransfer', 'SecurityTransfer', 'Dividend', 'SecurityInvestment'].indexOf(transaction.transaction_type) != -1">
								{{transaction.account.name}}
								<i class="action glyphicon glyphicon-share-alt pull-right" tooltip="Go to {{transaction.account.name}}" ng-click="switchAccount($event, transaction)"></i>
							</span>
							<!-- Toggle subtransactions -->
							<span ng-switch-default ng-if="['Split', 'LoanRepayment', 'Payslip'].indexOf(transaction.transaction_type) != -1">
								<button ng-click="toggleSubtransactions($event, transaction)" class="btn btn-xs btn-default toggle-subtransactions">
									<i class="glyphicon" ng-class="{'glyphicon-chevron-down': !transaction.showSubtransactions, 'glyphicon-chevron-up': transaction.showSubtransactions}"></i>
								</button>
							</span>
						</td>
					</tr>
					<!-- Subtransactions -->
					<tr ng-if="['Split', 'LoanRepayment', 'Payslip'].indexOf(transaction.transaction_type) != -1" ng-show="transaction.showSubtransactions">
						<td colspan="2">
							<table class="table-condensed">
								<thead>
									<tr>
										<th>Category</th>
										<th>Subcategory</th>
										<th>Description</th>
										<th class="amount">Amount</th>
									</tr>
									<tr og-table-loading="transaction.loadingSubtransactions" colspan="4"></tr>
								</thead>
								<tbody>
									<tr ng-repeat="subtransaction in transaction.subtransactions">
										<td>{{subtransaction.category.name}}</td>
										<td ng-if="subtransaction.transaction_type == 'Sub'">{{subtransaction.subcategory.name}}</td>
										<td ng-if="subtransaction.transaction_type == 'Subtransfer'">{{subtransaction.account.name}}</td>
										<td>{{subtransaction.memo}}</td>
										<td class="amount" ng-class="{'text-danger': (subtransaction.amount * (subtransaction.direction == transaction.direction ? 1 : -1)) < 0}">{{subtransaction.amount * (subtransaction.direction == transaction.direction ? 1 : -1) | currency}}</td>
									</tr>
								</tbody>
							</table>
						</td>
					</tr>
					<tr>
						<!-- Memo -->
						<td class="memo" colspan="2">
							<span>{{transaction.memo}}</span>
							<span ng-if="(!transaction.memo) && transaction.transaction_type == 'SecurityInvestment'">{{transaction.quantity | number}} @ ${{transaction.price | number:3}} <span ng-if="transaction.commission">(less {{transaction.commission | currency}} commission)</span></span>
						</td>
					</tr>
				</table>
			</td>
			<!-- Debit amount / Quantity -->
			<td class="amount details">
				<span ng-switch-default ng-if="transaction.direction == 'outflow'" ng-class="{'text-danger': transaction.amount < 0}">{{transaction.amount | currency}}</span>
				<table class="table-condensed" ng-switch-when="investment">
					<tr>
						<td>{{transaction.quantity | number}}</td>
					</tr>
					<tr ng-if="transaction.transaction_type == 'SecurityInvestment'">
						<td><em>Commission:</em></td>
					</tr>
				</table>
			</td>
			<!-- Credit Amount / Price / Commission -->
			<td class="amount details">
				<span ng-switch-default ng-if="transaction.direction == 'inflow'" ng-class="{'text-danger': transaction.amount < 0}">{{transaction.amount | currency}}</span>
				<table class="table-condensed" ng-switch-when="investment" ng-if="transaction.transaction_type == 'SecurityInvestment'">
					<tr>
						<td>${{transaction.price | number}}</td>
					</tr>
					<tr>
						<td>{{transaction.commission | currency}}</td>
					</tr>
				</table>
			</td>
			<!-- Balance / Investment Amount -->
			<td class="amount">
				<span ng-switch-default ng-class="{'text-danger': transaction.balance < 0}">{{transaction.balance | currency}}</span>
				<span ng-switch-when="investment" ng-if="transaction.transaction_type == 'SecurityInvestment'">{{transaction.quantity * transaction.price - transaction.commission | currency}}</span>
				<span ng-switch-when="investment" ng-if="transaction.transaction_type == 'Dividend'">{{transaction.amount | currency}}</span>
			</td>
		</tr>
	</tbody>
	<tfoot>
		<tr>
			<!-- Pagination -->
			<td colspan="5">
				<button class="btn btn-primary" ng-click="getTransactions('next')">Next</button>
				<span>{{firstTransactionDate | date:"dd/MM/yyyy"}} - {{lastTransactionDate | date:"dd/MM/yyyy"}}</span>
			</td>
		</tr>
		<!-- Loading indicator -->
		<tr og-table-loading="loading['next']" colspan="5"></tr>
	</tfoot>
</table>
